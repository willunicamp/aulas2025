<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visualizador de Bubble Sort</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500;600&family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }

        .code-font {
            font-family: 'Fira Code', monospace;
        }

        .highlight {
            background-color: rgba(59, 130, 246, 0.3); /* blue-500 with opacity */
            border-left: 4px solid #3B82F6; /* blue-500 */
            transition: background-color 0.3s ease;
        }

        .bar-container {
            transition: transform 0.5s ease-in-out;
        }
    </style>
</head>
<body class="bg-slate-100 text-slate-800 flex flex-col items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-7xl bg-white rounded-xl shadow-2xl p-6 md:p-8">
        <header class="text-center mb-8">
            <h1 class="text-2xl md:text-3xl font-bold text-slate-900">Visualizador do Algoritmo Bubble Sort</h1>
            <p class="text-md font-semibold text-slate-600 mt-4">Prof. William Paiva - COTIL</p>
            <p class="text-sm text-slate-500 mt-2">Clique em "Próximo Passo" ou use a seta para a direita (→) para executar.</p>
        </header>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <!-- Coluna do Código -->
            <div class="bg-slate-800 text-white rounded-lg p-6 shadow-inner">
                <h2 class="text-lg font-semibold mb-4 border-b border-slate-600 pb-2">Código em C</h2>
                <pre class="code-font text-xs md:text-sm"><code id="code-block">
<span id="line-0">void bubbleSort(int vetor[], int n) {</span>
<span id="line-1" class="pl-4 block">  for (int i = 0; i < n - 1; i++) {</span>
<span id="line-2" class="pl-8 block">    for (int j = 0; j < n - i - 1; j++) {</span>
<span id="line-3" class="pl-12 block">      if (vetor[j] > vetor[j+1]) {</span>
<span id="line-4" class="pl-16 block">        // Troca os elementos</span>
<span id="line-5" class="pl-16 block">        int temp = vetor[j];</span>
<span id="line-6" class="pl-16 block">        vetor[j] = vetor[j+1];</span>
<span id="line-7" class="pl-16 block">        vetor[j+1] = temp;</span>
<span id="line-8" class="pl-12 block">      }</span>
<span id="line-9" class="pl-8 block">    }</span>
<span id="line-10" class="pl-4 block">  }</span>
<span id="line-11" class="pl-0 block">}</span>
                </code></pre>
            </div>

            <!-- Coluna da Visualização -->
            <div>
                <h2 class="text-lg font-semibold mb-4 text-slate-900">Visualização do Vetor</h2>
                <div id="status-box" class="min-h-[5rem] bg-slate-50 border border-slate-200 rounded-lg p-4 mb-6 text-center flex items-center justify-center">
                    <p id="status-text" class="text-sm text-slate-600">Pronto para começar a ordenação.</p>
                </div>
                <div class="relative flex justify-around items-end h-64 bg-slate-50 border-2 border-slate-200 rounded-lg p-4" id="visualization-area">
                    <!-- Barras do vetor serão inseridas aqui -->
                </div>
                <div class="relative flex justify-around items-start mt-2" id="indices-area">
                    <!-- Índices do vetor serão inseridos aqui -->
                </div>

                <!-- Quadro de Variáveis -->
                <div class="mt-4 flex justify-center space-x-4 md:space-x-8">
                    <div class="text-center bg-slate-50 border border-slate-200 py-2 px-4 rounded-lg shadow-sm w-32">
                        <p class="text-xs font-semibold text-slate-500">Loop Externo (i)</p>
                        <p id="i-value" class="text-2xl font-bold text-blue-600">-</p>
                    </div>
                    <div class="text-center bg-slate-50 border border-slate-200 py-2 px-4 rounded-lg shadow-sm w-32">
                        <p class="text-xs font-semibold text-slate-500">Loop Interno (j)</p>
                        <p id="j-value" class="text-2xl font-bold text-amber-600">-</p>
                    </div>
                </div>
            </div>
        </div>

        <footer class="mt-8 text-center">
            <button id="next-step-btn" class="bg-blue-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-blue-700 transition-colors shadow-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 disabled:bg-slate-400 disabled:cursor-not-allowed">
                Próximo Passo
            </button>
        </footer>
    </div>

    <script>
        // --- CONFIGURAÇÕES ---
        const ARRAY_SIZE = 8;
        const MAX_VALUE = 100;
        const COLORS = {
            DEFAULT_BG: '#E2E8F0', // slate-200
            DEFAULT_BORDER: '#94A3B8', // slate-400
            COMPARING_BG: '#FBBF24', // amber-400
            COMPARING_BORDER: '#F59E0B', // amber-500
            SWAPPING_BG: '#F87171', // red-400
            SWAPPING_BORDER: '#EF4444', // red-500
            SORTED_BG: '#34D399', // emerald-400
            SORTED_BORDER: '#10B981', // emerald-500
        };

        // --- ELEMENTOS DA DOM ---
        const codeBlock = document.getElementById('code-block');
        const visualizationArea = document.getElementById('visualization-area');
        const indicesArea = document.getElementById('indices-area');
        const nextStepBtn = document.getElementById('next-step-btn');
        const statusText = document.getElementById('status-text');
        const iValueElement = document.getElementById('i-value');
        const jValueElement = document.getElementById('j-value');

        // --- ESTADO GLOBAL ---
        let array = [];
        let sortGenerator;
        let lastHighlightedLine = -1;

        // --- FUNÇÕES PRINCIPAIS ---

        /**
         * Inicializa a aplicação, gerando um novo vetor e preparando o visualizador.
         */
        function initialize() {
            const uniqueValues = new Set();
            while (uniqueValues.size < ARRAY_SIZE) {
                uniqueValues.add(Math.floor(Math.random() * MAX_VALUE) + 1);
            }
            array = Array.from(uniqueValues);
            sortGenerator = bubbleSortStepByStep([...array]);

            renderArray(array);
            updateStatus('Vetor inicial gerado. Clique em "Próximo Passo" para começar.');
            updateLoopVariables(undefined, undefined);

            nextStepBtn.disabled = false;
            nextStepBtn.innerText = 'Próximo Passo';
            nextStepBtn.onclick = handleNextStep;
            highlightLine(-1);
        }

        /**
         * Renderiza o vetor na tela, criando as barras e os índices.
         * @param {number[]} arr - O vetor a ser renderizado.
         * @param {object} highlights - Objeto opcional para destacar barras específicas.
         */
        function renderArray(arr, highlights = {}) {
            visualizationArea.innerHTML = '';
            indicesArea.innerHTML = '';

            const maxValue = Math.max(...arr, 1);

            arr.forEach((value, index) => {
                const barHeight = (value / maxValue) * 95;

                const barContainer = document.createElement('div');
                barContainer.id = `bar-container-${index}`;
                barContainer.className = 'bar-container flex flex-col-reverse items-center h-full';
                barContainer.style.width = `${100 / arr.length}%`;

                const bar = document.createElement('div');
                bar.id = `bar-${index}`;
                bar.style.height = `${barHeight}%`;
                bar.className = 'w-3/4 rounded-t-md border-2 border-b-0 transition-all duration-300 flex items-end justify-center pb-1 text-xs font-bold text-slate-700';
                bar.textContent = value;

                // Aplica estilos diretamente via JavaScript
                bar.style.backgroundColor = COLORS.DEFAULT_BG;
                bar.style.borderColor = COLORS.DEFAULT_BORDER;

                if (highlights.comparing && highlights.comparing.includes(index)) {
                    bar.style.backgroundColor = COLORS.COMPARING_BG;
                    bar.style.borderColor = COLORS.COMPARING_BORDER;
                }
                if (highlights.swapping && highlights.swapping.includes(index)) {
                    bar.style.backgroundColor = COLORS.SWAPPING_BG;
                    bar.style.borderColor = COLORS.SWAPPING_BORDER;
                }
                if (highlights.sorted && highlights.sorted.includes(index)) {
                    bar.style.backgroundColor = COLORS.SORTED_BG;
                    bar.style.borderColor = COLORS.SORTED_BORDER;
                }

                const indexLabel = document.createElement('div');
                indexLabel.className = 'text-center text-xs text-slate-500';
                indexLabel.style.width = `${100 / arr.length}%`;
                indexLabel.textContent = index;

                barContainer.appendChild(bar);
                visualizationArea.appendChild(barContainer);
                indicesArea.appendChild(indexLabel);
            });
        }

        function updateLoopVariables(i, j) {
            iValueElement.textContent = (i !== undefined) ? i : '-';
            jValueElement.textContent = (j !== undefined) ? j : '-';
        }

        function highlightLine(lineNumber) {
            if (lastHighlightedLine !== -1) {
                const prevLine = document.getElementById(`line-${lastHighlightedLine}`);
                if (prevLine) prevLine.classList.remove('highlight');
            }
            if (lineNumber !== -1) {
                const currentLine = document.getElementById(`line-${lineNumber}`);
                if (currentLine) currentLine.classList.add('highlight');
            }
            lastHighlightedLine = lineNumber;
        }

        function updateStatus(text) {
            statusText.innerHTML = text;
        }

        async function animateSwap(index1, index2) {
            const bar1 = document.getElementById(`bar-container-${index1}`);
            const bar2 = document.getElementById(`bar-container-${index2}`);
            if (!bar1 || !bar2) return;

            const rect1 = bar1.getBoundingClientRect();
            const rect2 = bar2.getBoundingClientRect();
            const distance = rect2.left - rect1.left;

            bar1.style.transform = `translateX(${distance}px)`;
            bar2.style.transform = `translateX(-${distance}px)`;

            return new Promise(resolve => setTimeout(resolve, 500));
        }

        // --- LÓGICA DO ALGORITMO (GENERATOR) ---
        function* bubbleSortStepByStep(arr) {
            const n = arr.length;
            const sortedIndices = [];

            yield { line: 0, array: [...arr], message: 'Iniciando a função `bubbleSort`.', sorted: [] };

            for (let i = 0; i < n - 1; i++) {
                yield { line: 1, array: [...arr], i, message: `Iniciando loop externo. <strong>i = ${i}</strong>.`, sorted: [...sortedIndices] };

                for (let j = 0; j < n - i - 1; j++) {
                    yield { line: 2, array: [...arr], i, j, comparing: [j, j + 1], message: `Iniciando loop interno. <strong>j = ${j}</strong>.`, sorted: [...sortedIndices] };
                    yield { line: 3, array: [...arr], i, j, comparing: [j, j + 1], message: `Comparando vetor[${j}] (<strong>${arr[j]}</strong>) com vetor[${j + 1}] (<strong>${arr[j + 1]}</strong>).`, sorted: [...sortedIndices] };

                    if (arr[j] > arr[j + 1]) {
                        yield { line: 4, array: [...arr], i, j, swapping: [j, j + 1], message: `Condição verdadeira (<strong>${arr[j]} > ${arr[j + 1]}</strong>). Trocando elementos.`, sorted: [...sortedIndices] };
                        yield { type: 'SWAP_ANIMATION', array: [...arr], index1: j, index2: j + 1, i, j, sorted: [...sortedIndices] };

                        [arr[j], arr[j + 1]] = [arr[j + 1], arr[j]];

                        yield { line: 7, array: [...arr], i, j, message: `Troca concluída. Vetor atualizado.`, sorted: [...sortedIndices] };
                    }
                    yield { line: 8, array: [...arr], i, j, message: 'Fim da verificação `if`.', sorted: [...sortedIndices] };
                }

                sortedIndices.push(n - 1 - i);
                yield { line: 9, array: [...arr], i, message: `Fim do loop interno para <strong>i = ${i}</strong>. O elemento (<strong>${arr[n - 1 - i]}</strong>) está na posição correta.`, sorted: [...sortedIndices] };
            }

            sortedIndices.push(0); // Adiciona o último elemento que sobra
            yield { line: 10, array: [...arr], message: 'Fim do loop externo.', sorted: [...sortedIndices] };
            yield { line: 11, array: [...arr], sorted: Array.from(Array(n).keys()), message: 'Ordenação concluída! O vetor está totalmente ordenado.' };

            return { done: true };
        }

        // --- MANIPULADOR DE EVENTOS ---
        async function handleNextStep() {
            const result = sortGenerator.next().value;

            if (!result || result.done) {
                updateStatus('Ordenação concluída! O vetor está totalmente ordenado.');
                nextStepBtn.innerText = 'Reiniciar';
                nextStepBtn.onclick = initialize;
                renderArray(array, { sorted: Array.from(Array(array.length).keys()) });
                updateLoopVariables(undefined, undefined);
                highlightLine(11);
                return;
            }

            if (result.type === 'SWAP_ANIMATION') {
                nextStepBtn.disabled = true;
                updateLoopVariables(result.i, result.j);
                renderArray(result.array, { swapping: [result.index1, result.index2], sorted: result.sorted });
                await animateSwap(result.index1, result.index2);
                nextStepBtn.disabled = false;
                handleNextStep();
                return;
            }

            highlightLine(result.line);
            updateStatus(result.message);
            updateLoopVariables(result.i, result.j);

            renderArray(result.array, {
                comparing: result.comparing,
                swapping: result.swapping,
                sorted: result.sorted
            });

            array = result.array;
        }

        nextStepBtn.addEventListener('click', handleNextStep);

        // Adiciona o listener para a tecla de seta para a direita
        document.addEventListener('keydown', (event) => {
            if (event.key === 'ArrowRight') {
                // Previne a ação padrão da tecla (como rolar a página)
                event.preventDefault();
                // Clica no botão apenas se ele não estiver desabilitado
                if (!nextStepBtn.disabled) {
                    nextStepBtn.click();
                }
            }
        });

        window.onload = initialize;
    </script>
</body>
</html>
